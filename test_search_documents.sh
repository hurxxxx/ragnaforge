#!/bin/bash

# ë‹¤ì–‘í•œ ê²€ìƒ‰ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ë¬¸ì„œ ì—…ë¡œë“œ ë° ê²€ìƒ‰ ìŠ¤í¬ë¦½íŠ¸

API_BASE="http://127.0.0.1:8000"
API_KEY="sk-kure-v1-test-key-12345"

echo "ðŸš€ ë‹¤ì–‘í•œ ê²€ìƒ‰ì–´ í…ŒìŠ¤íŠ¸ ì‹œìž‘"
echo "API ì„œë²„: $API_BASE"
echo "API í‚¤: $API_KEY"
echo ""

# í…ŒìŠ¤íŠ¸ ë¬¸ì„œë“¤ ìƒì„±
echo "=== í…ŒìŠ¤íŠ¸ ë¬¸ì„œ ìƒì„± ==="

# ë¬¸ì„œ 1: ê¸°ìˆ  ë¬¸ì„œ
cat > tech_doc.txt << 'EOF'
ì¸ê³µì§€ëŠ¥ê³¼ ë¨¸ì‹ ëŸ¬ë‹ ê¸°ìˆ  ê°œìš”

ì¸ê³µì§€ëŠ¥(AI)ì€ ì»´í“¨í„°ê°€ ì¸ê°„ì˜ ì§€ëŠ¥ì„ ëª¨ë°©í•˜ì—¬ í•™ìŠµ, ì¶”ë¡ , ë¬¸ì œ í•´ê²° ë“±ì„ ìˆ˜í–‰í•˜ëŠ” ê¸°ìˆ ìž…ë‹ˆë‹¤.
ë¨¸ì‹ ëŸ¬ë‹ì€ AIì˜ í•˜ìœ„ ë¶„ì•¼ë¡œ, ë°ì´í„°ë¥¼ í†µí•´ íŒ¨í„´ì„ í•™ìŠµí•˜ê³  ì˜ˆì¸¡ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

ì£¼ìš” ê¸°ìˆ :
- ë”¥ëŸ¬ë‹: ì‹ ê²½ë§ì„ ì´ìš©í•œ í•™ìŠµ
- ìžì—°ì–´ì²˜ë¦¬: í…ìŠ¤íŠ¸ ë¶„ì„ ë° ì´í•´
- ì»´í“¨í„° ë¹„ì „: ì´ë¯¸ì§€ ì¸ì‹ ë° ë¶„ì„
- ê°•í™”í•™ìŠµ: í™˜ê²½ê³¼ì˜ ìƒí˜¸ìž‘ìš©ì„ í†µí•œ í•™ìŠµ

Pythonì€ AI/ML ê°œë°œì— ê°€ìž¥ ë„ë¦¬ ì‚¬ìš©ë˜ëŠ” í”„ë¡œê·¸ëž˜ë° ì–¸ì–´ìž…ë‹ˆë‹¤.
TensorFlow, PyTorch, scikit-learn ë“±ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì¸ê¸°ê°€ ë†’ìŠµë‹ˆë‹¤.
EOF

# ë¬¸ì„œ 2: ìš”ë¦¬ ë ˆì‹œí”¼
cat > recipe_doc.txt << 'EOF'
ê¹€ì¹˜ì°Œê°œ ë§Œë“œëŠ” ë°©ë²•

ìž¬ë£Œ:
- ê¹€ì¹˜ 200g
- ë¼ì§€ê³ ê¸° 150g
- ë‘ë¶€ 1/2ëª¨
- ëŒ€íŒŒ 1ëŒ€
- ì–‘íŒŒ 1/2ê°œ
- ë§ˆëŠ˜ 3ìª½
- ê³ ì¶§ê°€ë£¨ 1í°ìˆ 
- ì°¸ê¸°ë¦„ 1ìž‘ì€ìˆ 

ì¡°ë¦¬ë²•:
1. ë¼ì§€ê³ ê¸°ë¥¼ í•œìž… í¬ê¸°ë¡œ ìžë¥´ê³  ì–‘ë…í•©ë‹ˆë‹¤.
2. íŒ¬ì— ì°¸ê¸°ë¦„ì„ ë‘ë¥´ê³  ë¼ì§€ê³ ê¸°ë¥¼ ë³¶ìŠµë‹ˆë‹¤.
3. ê¹€ì¹˜ë¥¼ ë„£ê³  í•¨ê»˜ ë³¶ì•„ì¤ë‹ˆë‹¤.
4. ë¬¼ì„ ë„£ê³  ë“ì¸ í›„ ë‘ë¶€ì™€ ì•¼ì±„ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
5. ê°„ì„ ë§žì¶”ê³  10ë¶„ê°„ ë” ë“ìž…ë‹ˆë‹¤.

ë§›ìžˆëŠ” ê¹€ì¹˜ì°Œê°œ ì™„ì„±!
EOF

# ë¬¸ì„œ 3: ì—¬í–‰ ê°€ì´ë“œ
cat > travel_doc.txt << 'EOF'
ì œì£¼ë„ ì—¬í–‰ ê°€ì´ë“œ

ì œì£¼ë„ëŠ” ëŒ€í•œë¯¼êµ­ì˜ ì•„ë¦„ë‹¤ìš´ ì„¬ìœ¼ë¡œ ë‹¤ì–‘í•œ ê´€ê´‘ëª…ì†Œê°€ ìžˆìŠµë‹ˆë‹¤.

ì£¼ìš” ê´€ê´‘ì§€:
- í•œë¼ì‚°: ì œì£¼ë„ì˜ ìµœê³ ë´‰, ë“±ì‚°ê³¼ íŠ¸ë ˆí‚¹
- ì„±ì‚°ì¼ì¶œë´‰: ì¼ì¶œ ëª…ì†Œ, ìœ ë„¤ìŠ¤ì½” ì„¸ê³„ìžì—°ìœ ì‚°
- ìš°ë„: ìž‘ì€ ì„¬, ìžì „ê±° ì—¬í–‰
- ì¤‘ë¬¸ê´€ê´‘ë‹¨ì§€: í•´ë³€ê³¼ ë¦¬ì¡°íŠ¸
- ì²œì§€ì—°í­í¬: ì•„ë¦„ë‹¤ìš´ í­í¬

ì œì£¼ íŠ¹ì‚°í’ˆ:
- ê°ê·¤: ì œì£¼ë„ì˜ ëŒ€í‘œ ê³¼ì¼
- í‘ë¼ì§€: ì œì£¼ë„ íŠ¹ì‚° ë¼ì§€ê³ ê¸°
- í•œë¼ë´‰: ì œì£¼ë„ íŠ¹ì‚° ê°ê·¤ë¥˜
- ë…¹ì°¨: ì œì£¼ë„ì—ì„œ ìž¬ë°°ë˜ëŠ” ì°¨

êµí†µ: í•­ê³µíŽ¸ìœ¼ë¡œ ì ‘ê·¼ ê°€ëŠ¥, ë Œí„°ì¹´ ì´ìš© ì¶”ì²œ
EOF

# ë¬¸ì„œ 4: ê±´ê°• ì •ë³´
cat > health_doc.txt << 'EOF'
ê±´ê°•í•œ ìƒí™œìŠµê´€ ê°€ì´ë“œ

ê·œì¹™ì ì¸ ìš´ë™ê³¼ ê· í˜•ìž¡ížŒ ì‹ë‹¨ì€ ê±´ê°•í•œ ì‚¶ì˜ ê¸°ë³¸ìž…ë‹ˆë‹¤.

ìš´ë™ ê¶Œìž¥ì‚¬í•­:
- ìœ ì‚°ì†Œ ìš´ë™: ì£¼ 3-4íšŒ, 30ë¶„ ì´ìƒ
- ê·¼ë ¥ ìš´ë™: ì£¼ 2-3íšŒ
- ìŠ¤íŠ¸ë ˆì¹­: ë§¤ì¼ 10-15ë¶„
- ê±·ê¸°: í•˜ë£¨ 8000-10000ë³´

ì˜ì–‘ ê´€ë¦¬:
- ì¶©ë¶„í•œ ìˆ˜ë¶„ ì„­ì·¨ (í•˜ë£¨ 2L)
- ë‹¤ì–‘í•œ ì±„ì†Œì™€ ê³¼ì¼ ì„­ì·¨
- ë‹¨ë°±ì§ˆ ì ì ˆí•œ ì„­ì·¨
- ê°€ê³µì‹í’ˆ ì¤„ì´ê¸°
- ê·œì¹™ì ì¸ ì‹ì‚¬ì‹œê°„

ìˆ˜ë©´ ê´€ë¦¬:
- í•˜ë£¨ 7-8ì‹œê°„ ìˆ˜ë©´
- ê·œì¹™ì ì¸ ìˆ˜ë©´ íŒ¨í„´
- ì·¨ì¹¨ ì „ ìŠ¤ë§ˆíŠ¸í° ì‚¬ìš© ìžì œ
- íŽ¸ì•ˆí•œ ìˆ˜ë©´ í™˜ê²½ ì¡°ì„±

ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ë„ ì¤‘ìš”í•©ë‹ˆë‹¤.
EOF

echo "âœ… í…ŒìŠ¤íŠ¸ ë¬¸ì„œ 4ê°œ ìƒì„± ì™„ë£Œ"

# ë¬¸ì„œ ì—…ë¡œë“œ
echo ""
echo "=== ë¬¸ì„œ ì—…ë¡œë“œ ==="

upload_file() {
    local file=$1
    local filename=$(basename "$file")
    echo "ðŸ“„ ì—…ë¡œë“œ ì¤‘: $filename"
    
    response=$(curl -s -X POST \
        -H "Authorization: Bearer $API_KEY" \
        -F "file=@$file" \
        "$API_BASE/v1/files/upload")
    
    echo "ì‘ë‹µ: $response" | jq .
    echo ""
}

upload_file "tech_doc.txt"
upload_file "recipe_doc.txt" 
upload_file "travel_doc.txt"
upload_file "health_doc.txt"

echo "=== ë¬¸ì„œ ì²˜ë¦¬ ëŒ€ê¸° (5ì´ˆ) ==="
sleep 5

# ë‹¤ì–‘í•œ ê²€ìƒ‰ì–´ í…ŒìŠ¤íŠ¸
echo ""
echo "=== ë‹¤ì–‘í•œ ê²€ìƒ‰ì–´ í…ŒìŠ¤íŠ¸ ==="

test_search() {
    local search_type=$1
    local query=$2
    local description=$3
    
    echo "ðŸ” $description"
    echo "ê²€ìƒ‰ì–´: '$query'"
    echo "ê²€ìƒ‰ íƒ€ìž…: $search_type"
    
    case $search_type in
        "text")
            endpoint="$API_BASE/v1/search/text"
            ;;
        "vector")
            endpoint="$API_BASE/v1/search/vector"
            ;;
        "hybrid")
            endpoint="$API_BASE/v1/search/hybrid"
            ;;
    esac
    
    response=$(curl -s -X POST \
        -H "Authorization: Bearer $API_KEY" \
        -H "Content-Type: application/json" \
        -d "{\"query\": \"$query\", \"limit\": 3, \"highlight\": true}" \
        "$endpoint")
    
    echo "ê²°ê³¼:"
    echo "$response" | jq '{
        success: .success,
        total_results: .total_results,
        search_time: .search_time,
        results: .results | map({
            id: .id,
            score: .score,
            content: .content[0:100] + "...",
            highlights: .highlights
        })
    }'
    echo ""
    echo "---"
    echo ""
}

# 1. ê¸°ìˆ  ê´€ë ¨ ê²€ìƒ‰
test_search "text" "ì¸ê³µì§€ëŠ¥" "ê¸°ìˆ  ìš©ì–´ ê²€ìƒ‰ (í…ìŠ¤íŠ¸)"
test_search "vector" "ë¨¸ì‹ ëŸ¬ë‹ê³¼ ë”¥ëŸ¬ë‹" "ê¸°ìˆ  ê°œë… ê²€ìƒ‰ (ë²¡í„°)"
test_search "hybrid" "Python í”„ë¡œê·¸ëž˜ë°" "í”„ë¡œê·¸ëž˜ë° ì–¸ì–´ ê²€ìƒ‰ (í•˜ì´ë¸Œë¦¬ë“œ)"

# 2. ìš”ë¦¬ ê´€ë ¨ ê²€ìƒ‰
test_search "text" "ê¹€ì¹˜ì°Œê°œ" "ìš”ë¦¬ëª… ê²€ìƒ‰ (í…ìŠ¤íŠ¸)"
test_search "vector" "ë¼ì§€ê³ ê¸° ìš”ë¦¬ ë§Œë“¤ê¸°" "ìš”ë¦¬ ë°©ë²• ê²€ìƒ‰ (ë²¡í„°)"
test_search "hybrid" "ë‘ë¶€ ìž¬ë£Œ" "ìž¬ë£Œ ê²€ìƒ‰ (í•˜ì´ë¸Œë¦¬ë“œ)"

# 3. ì—¬í–‰ ê´€ë ¨ ê²€ìƒ‰
test_search "text" "ì œì£¼ë„" "ì§€ì—­ëª… ê²€ìƒ‰ (í…ìŠ¤íŠ¸)"
test_search "vector" "í•œë¼ì‚° ë“±ì‚°" "ê´€ê´‘ì§€ í™œë™ ê²€ìƒ‰ (ë²¡í„°)"
test_search "hybrid" "ê°ê·¤ íŠ¹ì‚°í’ˆ" "íŠ¹ì‚°í’ˆ ê²€ìƒ‰ (í•˜ì´ë¸Œë¦¬ë“œ)"

# 4. ê±´ê°• ê´€ë ¨ ê²€ìƒ‰
test_search "text" "ìš´ë™" "ê±´ê°• í‚¤ì›Œë“œ ê²€ìƒ‰ (í…ìŠ¤íŠ¸)"
test_search "vector" "ê±´ê°•í•œ ì‹ë‹¨ ê´€ë¦¬" "ê±´ê°• ê´€ë¦¬ ê²€ìƒ‰ (ë²¡í„°)"
test_search "hybrid" "ìˆ˜ë©´ íŒ¨í„´" "ìƒí™œìŠµê´€ ê²€ìƒ‰ (í•˜ì´ë¸Œë¦¬ë“œ)"

# 5. ë³µí•© ê²€ìƒ‰ì–´
test_search "text" "ì œì£¼ë„ í‘ë¼ì§€" "ë³µí•© í‚¤ì›Œë“œ ê²€ìƒ‰ (í…ìŠ¤íŠ¸)"
test_search "vector" "ê±´ê°•í•œ ìš´ë™ê³¼ ì˜ì–‘ ê´€ë¦¬" "ë³µí•© ê°œë… ê²€ìƒ‰ (ë²¡í„°)"
test_search "hybrid" "AI ê¸°ìˆ ê³¼ Python" "ê¸°ìˆ  ì¡°í•© ê²€ìƒ‰ (í•˜ì´ë¸Œë¦¬ë“œ)"

# 6. í•œê¸€/ì˜ì–´ í˜¼í•©
test_search "text" "TensorFlow ë¼ì´ë¸ŒëŸ¬ë¦¬" "í•œì˜ í˜¼í•© ê²€ìƒ‰ (í…ìŠ¤íŠ¸)"
test_search "vector" "machine learning ë¨¸ì‹ ëŸ¬ë‹" "í•œì˜ ë™ì˜ì–´ ê²€ìƒ‰ (ë²¡í„°)"

# 7. ë¶€ë¶„ ì¼ì¹˜ ê²€ìƒ‰
test_search "text" "ì°Œê°œ" "ë¶€ë¶„ ë‹¨ì–´ ê²€ìƒ‰ (í…ìŠ¤íŠ¸)"
test_search "vector" "ì„¬ ì—¬í–‰" "ì¼ë°˜ì  ê°œë… ê²€ìƒ‰ (ë²¡í„°)"

# 8. ì¡´ìž¬í•˜ì§€ ì•ŠëŠ” ê²€ìƒ‰ì–´
test_search "text" "ë¸”ë¡ì²´ì¸ ì•”í˜¸í™”í" "ì¡´ìž¬í•˜ì§€ ì•ŠëŠ” ë‚´ìš© ê²€ìƒ‰ (í…ìŠ¤íŠ¸)"
test_search "vector" "ìš°ì£¼ì—¬í–‰ í™”ì„±íƒì‚¬" "ì¡´ìž¬í•˜ì§€ ì•ŠëŠ” ë‚´ìš© ê²€ìƒ‰ (ë²¡í„°)"

echo "ðŸŽ‰ ëª¨ë“  ê²€ìƒ‰ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!"

# ì •ë¦¬
rm -f tech_doc.txt recipe_doc.txt travel_doc.txt health_doc.txt
echo "âœ… í…ŒìŠ¤íŠ¸ íŒŒì¼ ì •ë¦¬ ì™„ë£Œ"
