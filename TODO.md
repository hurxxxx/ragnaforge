# Ragnaforge Development TODO
## 🎯 프로젝트 목적: 기업용 문서 관리 시스템 고도화 API 서버

### 📋 핵심 요구사항 (2025-07-25 업데이트)
- **OpenAI 호환 API**: 임베딩 기능은 OpenAI API 스펙 완전 준수
- **MCP 프로토콜 지원**: 외부 LLM 서비스에서 MCP로 검색 기능 호출 가능
- **표준 REST API**: 전체 기능을 빠짐없이 OpenAPI 표준 REST API로 서비스
- **문서 변환 추상화**: 로컬 Docling/Marker 기본, 외부 서비스 옵션 (Datalab Marker 우선)
- **모듈화된 파이프라인**: 문서 변환→청킹→임베딩→저장 각 단계별 독립 호출 가능
- **하이브리드 아키텍처**: 로컬 모델 우선, 외부 API 연동 지원

## 🚀 현재 우선순위 작업 (2025-07-25 재정리)

### 🔶 HIGH PRIORITY

#### 1. OpenAI 호환 임베딩 API 개선 - `/v1/embeddings`
- [ ] **OpenAI API 스펙 완전 준수**
  - [ ] 요청/응답 형식 완전 호환 (input, model, encoding_format, dimensions, user 필드)
  - [ ] 배치 처리 및 토큰 제한 처리 개선
  - [ ] usage 필드 정확한 토큰 계산 (prompt_tokens, total_tokens)
- [ ] **에러 코드 및 메시지 표준화**
  - [ ] OpenAI API와 동일한 에러 코드 및 메시지 형식
  - [ ] 400, 401, 429, 500 등 표준 HTTP 상태 코드 적용
  - [ ] 에러 응답 구조 표준화 (error.type, error.message, error.code)

#### 2. MCP (Model Context Protocol) 지원 구현
- [ ] **MCP 서버 구현**
  - [ ] Model Context Protocol 서버 구현
  - [ ] 프로토콜 스펙 준수 (JSON-RPC 2.0 기반)
  - [ ] 클라이언트 연결 관리 및 세션 처리
- [ ] **검색 기능 MCP 인터페이스**
  - [ ] 벡터 검색 MCP 도구 (vector_search)
  - [ ] 텍스트 검색 MCP 도구 (text_search)
  - [ ] 통합 검색 MCP 도구 (hybrid_search)
  - [ ] 문서 업로드 및 처리 MCP 도구
- [ ] **레거시 시스템 연동 지원**
  - [ ] 기존 시스템과의 호환성을 위한 MCP 어댑터
  - [ ] 다양한 클라이언트 지원 (Claude, GPT, 기타 LLM)

#### 3. 표준 REST API 완성
- [ ] **업계 표준 API 패턴 적용**
  - [ ] REST API 설계 베스트 프랙티스 적용
  - [ ] 일관된 에러 처리 및 상태 코드
  - [ ] 표준 HTTP 메서드 및 상태 코드 사용
- [ ] **API 버전 관리 시스템**
  - [ ] API 버전 관리 체계 구축 (/v1/, /v2/)
  - [ ] 하위 호환성 보장 메커니즘
  - [ ] 버전별 기능 지원 매트릭스
- [ ] **포괄적인 OpenAPI 문서화**
  - [ ] 전체 API에 대한 상세한 OpenAPI 3.0 스펙 작성
  - [ ] 자동 문서 생성 및 업데이트
  - [ ] 인터랙티브 API 문서 (Swagger UI)
  - [ ] 코드 예제 및 SDK 생성

#### 4. 문서 변환 추상화 레이어 구현
- [ ] **문서 변환 서비스 추상화**
  - [ ] Docling, Marker, 외부 서비스를 위한 공통 인터페이스
  - [ ] 변환 엔진 선택 로직 (auto, manual)
  - [ ] 변환 품질 평가 및 최적 엔진 선택
- [ ] **Datalab Marker 연동**
  - [ ] Datalab의 Marker 서비스 API 연동
  - [ ] 외부 서비스 인증 및 보안 처리
  - [ ] 네트워크 오류 처리 및 재시도 로직
- [ ] **변환 결과 캐싱 시스템**
  - [ ] 문서 해시 기반 캐싱
  - [ ] 변환 결과 저장 및 조회
  - [ ] 캐시 만료 및 정리 정책

### 🔷 MEDIUM PRIORITY

#### 5. 모듈화된 문서 처리 파이프라인 개선
- [ ] **문서 변환 API** - `/v1/convert`
  - [ ] 독립적인 변환 API 엔드포인트
  - [ ] 다양한 입력 형식 지원 (PDF, DOCX, PPTX, etc.)
  - [ ] 변환 옵션 세부 설정 (이미지 추출, 품질 설정)
- [ ] **문서 청킹 API** - `/v1/chunk`
  - [ ] 독립적인 청킹 API 엔드포인트
  - [ ] 다양한 청킹 전략 지원 (token, semantic, recursive)
  - [ ] 청킹 결과 검증 및 품질 관리
- [ ] **통합 문서 처리 API** - `/v1/process`
  - [ ] 변환→청킹→임베딩→저장 원스톱 처리
  - [ ] 각 단계별 개별 호출 지원
  - [ ] 처리 상태 추적 및 진행률 API
  - [ ] 실패 시 롤백 및 재시도 로직

#### 6. 필터링 기반 하이브리드 검색 구현 (HIGH PRIORITY로 승격)
- [ ] **하이브리드 검색 API** - `/v1/search/hybrid`
  - [ ] 1차 병렬 검색: 벡터 검색 + 텍스트 검색 동시 수행
  - [ ] 2차 필터링된 벡터 검색: 텍스트 검색 문서 ID로 벡터 검색 필터링
  - [ ] 청크 레벨 결과 융합: 중복 제거 및 스코어 기반 정렬
  - [ ] 문서 다양성 확보: 문서당 청크 수 제한 로직
- [ ] **문서 ID 기반 필터링 시스템**
  - [ ] 텍스트 검색 결과에서 문서 ID 추출 로직
  - [ ] Qdrant 메타데이터 필터링 최적화
  - [ ] 동일 문서 ID 매핑 검증 시스템
- [ ] **비동기 병렬 검색 엔진**
  - [ ] asyncio 기반 1차 병렬 검색 구현
  - [ ] 2차 필터링된 벡터 검색 최적화
  - [ ] 검색 성능 모니터링 및 로깅
- [ ] **결과 융합 및 최적화**
  - [ ] 청크 레벨 중복 제거 알고리즘
  - [ ] 스코어 기반 결과 정렬 및 융합
  - [ ] Rerank 적용 및 최종 결과 반환

### 🔷 LOW PRIORITY

#### 7. 드라이브 기능 API (구글 드라이브/OneDrive 수준)
- [ ] **파일 관리 API** - `/v1/drive/files`
  - [ ] 구글 드라이브 API 스펙 준수
  - [ ] 파일 업로드/다운로드/삭제
  - [ ] 폴더 구조 관리 (생성/이동/복사)
  - [ ] 파일 메타데이터 관리
- [ ] **권한 관리 API** - `/v1/drive/permissions`
  - [ ] 파일/폴더별 권한 설정
  - [ ] 사용자/그룹 기반 접근 제어
  - [ ] 공유 링크 생성 및 관리
  - [ ] 권한 상속 및 위임
- [ ] **버전 관리 API** - `/v1/drive/versions`
  - [ ] 파일 버전 히스토리
  - [ ] 버전 간 비교 및 복원
  - [ ] 자동 백업 및 스냅샷
  - [ ] 변경 이력 추적

#### 8. 스마트 중복 파일 관리 (기업 효율성)
- [ ] **중복 검사 API** - `/v1/duplicates`
  - [ ] 파일 해시 기반 중복 검사
  - [ ] 내용 기반 유사도 검사
  - [ ] 중복 파일 그룹화 및 관리
  - [ ] 중복 제거 권장사항 제공
- [ ] **캐싱 최적화 시스템**
  - [ ] 변환 결과 캐싱 (docling/marker)
  - [ ] 임베딩 결과 캐싱
  - [ ] 검색 결과 캐싱
  - [ ] 캐시 히트율 모니터링

#### 9. 기업용 모니터링 & 분석
- [ ] **사용량 분석 API** - `/v1/analytics`
  - [ ] 문서 업로드/검색 통계
  - [ ] 사용자별 활동 분석
  - [ ] 인기 검색어 및 문서 분석
  - [ ] 시스템 성능 리포트
- [ ] **기업용 대시보드 API**
  - [ ] 실시간 시스템 상태
  - [ ] 비용 분석 (외부 API 사용량)
  - [ ] 보안 이벤트 모니터링
  - [ ] SLA 준수 현황

#### 8. ⚙️ 기업용 설정 관리 시스템
- [ ] **다중 테넌트 설정 API** - `/v1/config`
  - [ ] 조직별 설정 분리
  - [ ] 환경별 설정 관리 (dev/staging/prod)
  - [ ] 설정 템플릿 및 상속
  - [ ] 동적 설정 변경 및 적용
- [ ] **보안 설정 API**
  - [ ] API 키 관리 및 로테이션
  - [ ] 접근 권한 설정
  - [ ] 감사 로그 설정
  - [ ] 데이터 보존 정책

#### 9. 🌐 웹 크롤링 & 외부 데이터 수집 
- [ ] **웹 크롤링 API** - `/v1/crawl`
  - [ ] URL 기반 문서 수집
  - [ ] 다중 파일 형식 지원
  - [ ] 크롤링 스케줄링 및 관리
  - [ ] robots.txt 준수 및 예의 크롤링

#### 10. 🔄 다중 백엔드 지원 (확장성, )
- [ ] **벡터 데이터베이스 추상화**
  - [ ] Qdrant, Milvus, Weaviate 지원
  - [ ] 백엔드 자동 선택 및 로드밸런싱
  - [ ] 데이터 마이그레이션 도구
- [ ] **검색 엔진 추상화**
  - [ ] MeiliSearch, Elasticsearch, OpenSearch 지원
  - [ ] 검색 성능 비교 및 최적화
  - [ ] 백엔드별 특화 기능 활용

### 🔷 LOW PRIORITY

#### 11. 🖥️ 기업용 관리 콘솔 (프론트엔드)
- [ ] **기업용 관리 대시보드**
  - [ ] 시스템 상태 모니터링
  - [ ] 사용량 분석 및 리포트
  - [ ] 사용자 관리 및 권한 설정
  - [ ] 비용 분석 및 최적화 제안
- [ ] **문서 관리 인터페이스**
  - [ ] 드라이브 형태의 파일 브라우저
  - [ ] 고급 검색 및 필터링
  - [ ] 배치 작업 관리
  - [ ] 문서 미리보기 및 편집
- [ ] **시스템 설정 및 관리**
  - [ ] 다중 테넌트 설정
  - [ ] API 키 및 보안 관리
  - [ ] 외부 서비스 연동 설정
  - [ ] 백업 및 복구 관리

#### 9. 🧠 임베딩 모델 성능 보완
- [ ] 감정 분석 모델 통합
- [ ] 동음이의어 감지 시스템
- [ ] 하이브리드 유사도 계산 시스템
- [ ] 임베딩 품질 평가 시스템

#### 10. 🌐 MCP (Model Context Protocol) 지원
- [ ] MCP 서버 구현
- [ ] 프로토콜 스펙 준수
- [ ] AI 모델 통합 인터페이스
- [ ] Claude/GPT 등 외부 모델 연동

#### 11. 🕷️ 웹 크롤링 & URL 기반 문서 수집 (상세)
- [ ] **URL 크롤링 API** - `POST /v1/crawl/url`
  - [ ] 웹페이지 크롤링 (HTML 파싱, 텍스트 추출)
  - [ ] PDF 파일 다운로드 및 텍스트 추출
  - [ ] 이미지 파일 OCR 처리 (PNG, JPG, JPEG)
  - [ ] Office 문서 처리 (DOCX, PPTX, XLSX)
  - [ ] 텍스트 파일 처리 (TXT, MD, CSV)
  - [ ] 압축 파일 처리 (ZIP, RAR)
- [ ] **URL 검증 및 전처리**
  - [ ] URL 형식 검증 및 정규화
  - [ ] 리다이렉트 처리 및 최종 URL 추적
  - [ ] 접근 권한 확인 (robots.txt, 인증)
  - [ ] 파일 크기 제한 및 타임아웃 설정
- [ ] **콘텐츠 처리 파이프라인**
  - [ ] 메타데이터 추출 (제목, 작성자, 생성일)
  - [ ] 텍스트 정제 및 구조화
  - [ ] 자동 언어 감지
  - [ ] 청킹 및 벡터화
- [ ] **크롤링 관리 시스템**
  - [ ] 크롤링 작업 큐 및 스케줄링
  - [ ] 재시도 로직 및 오류 처리
  - [ ] 크롤링 히스토리 및 상태 추적
  - [ ] 동시 크롤링 제한 및 속도 조절
- [x] 중복 문서 감지 및 처리 - 파일 해시 기반 구현 완료

#### 12. 🔗 외부 데이터 소스 연계
- [ ] 공공 데이터 API 연계
- [ ] 외부 API 통합 프레임워크
- [ ] 데이터 소스 관리
- [ ] 자동 데이터 수집 및 업데이트

#### 13. 🤖 AI 에이전트 기능
- [ ] 질의응답 시스템
- [ ] 문서 요약 기능
- [ ] 자동 태깅 및 분류
- [ ] 지능형 검색 추천

## 🛠️ 기술적 개선사항

### 🔧 코드 품질 & 구조
- [ ] 의존성 주입 패턴 도입
- [ ] 코드 문서화 확장
- [ ] 타입 힌트 완성도 향상

### 🧪 테스트 시스템
- [x] **종합 테스트 스위트** - 82개 테스트 케이스, 100% 성공률 달성
- [ ] 프론트엔드 단위 테스트 (Jest, React Testing Library)
- [ ] E2E 테스트 (Playwright)
- [ ] 부하 테스트 시나리오
- [ ] CI/CD 파이프라인 통합

### 📦 배포 & 운영
- [ ] 프론트엔드 Docker 컨테이너화
- [ ] Kubernetes 배포 설정
- [ ] 환경별 배포 스크립트
- [ ] 로드 밸런싱 설정
- [ ] 백업 및 복구 전략

## 🎯 기업용 문서 관리 시스템 개발 전략 (2025-07-25 업데이트)

### 📋 핵심 개발 원칙

**API 우선 설계 (API-First Design)**
- 모든 기능을 표준 REST API로 구현하여 레거시 시스템 호환성 확보
- OpenAI 호환 API로 기존 AI 워크플로우 지원
- MCP 프로토콜 지원으로 최신 LLM 생태계 연동
- 표준 API 스펙 준수로 기존 시스템과의 원활한 통합

**모듈화된 아키텍처**
- 문서 변환 서비스 추상화 (로컬 Docling/Marker + 외부 서비스)
- 각 기능별 독립적인 API 엔드포인트
- 외부 서비스 연동을 위한 추상화 레이어
- 플러그인 시스템으로 확장성 확보

**기업 요구사항 우선**
- 보안 및 권한 관리 시스템
- 감사 로그 및 컴플라이언스
- 다중 테넌트 지원
- 고가용성 및 확장성

### 🏗️ 기업용 기술 스택

**핵심 백엔드 기술**
- **FastAPI** - OpenAPI 자동 생성, 고성능 비동기 처리
- **Qdrant** - 벡터 검색 (로컬 배포 가능)
- **MeiliSearch** - 전문 검색 (타이포 허용, 빠른 응답)
- **PostgreSQL** - 기업용 메타데이터 저장
- **Redis** - 세션, 캐싱, 작업 큐

**기업용 추가 기술**
- **Celery** - 백그라운드 작업 처리
- **Nginx** - 로드 밸런싱, SSL 터미네이션
- **Docker/Kubernetes** - 컨테이너 오케스트레이션
- **Prometheus/Grafana** - 모니터링 및 알림
- **ELK Stack** - 로그 수집 및 분석

**외부 서비스 연동**
- **OpenAI API** - 임베딩 및 LLM 서비스
- **Azure/AWS** - 클라우드 서비스 연동
- **LDAP/SAML** - 기업 인증 시스템 연동

### 📋 기업용 개발 가이드라인

### API 설계 원칙
- ✅ **표준 준수**: OpenAI API, REST API 표준 스펙 준수
- ✅ **하위 호환성**: 기존 시스템과의 완벽한 호환성 보장
- ✅ **확장성**: 마이크로서비스 아키텍처 준비
- ✅ **보안**: 기업급 보안 요구사항 충족
- ✅ **모니터링**: 포괄적인 로깅 및 메트릭 수집


### 우선순위 결정 기준
1. ✅ 핵심 RAG 기능 완성도 - **달성**
2. 🔄 사용자 경험 개선 - **진행 중 (React 전환)**
3. ✅ 시스템 안정성 - **달성**
4. 🔄 확장성 및 유지보수성 - **진행 중**


## 🎯 프로젝트 성공 지표

### 기술적 목표
- ✅ **API 호환성**: OpenAI API 100% 호환
- ✅ **성능**: 검색 응답 시간 < 200ms
- ✅ **확장성**: 동시 사용자 1000명 지원
- ✅ **가용성**: 99.9% 업타임 달성

### 비즈니스 목표
- 🔄 **레거시 연동**: 기존 시스템 무중단 마이그레이션
- 🔄 **사용자 만족도**: 기존 대비 검색 정확도 30% 향상
- 🔄 **운영 효율성**: 문서 처리 시간 50% 단축
- 🔄 **비용 최적화**: 외부 API 비용 40% 절감

## 🎉 최근 완료된 기능

### ✅ TODO 재정리 및 우선순위 조정 (2025-07-25)
- **핵심 요구사항 명확화**: OpenAI 호환, MCP 지원, 표준 REST API, 문서 변환 추상화
- **우선순위 재조정**: HIGH/MEDIUM/LOW 우선순위로 작업 분류
- **Datalab Marker 연동**: 외부 문서 변환 서비스 연동 계획 수립
- **MCP 프로토콜 지원**: 외부 LLM 서비스 연동을 위한 MCP 서버 구현 계획

### ✅ 코드베이스 정리 & 개발 환경 최적화 (2025-07-24)
- **임시 파일 정리**: temp_processing, test_outputs, __pycache__ 등 불필요한 파일 삭제
- **하드코딩된 값 환경변수화**: IP 주소, API 키 등을 환경변수로 분리
- **Makefile 수정**: 실제 존재하는 테스트 스크립트로 업데이트
- **문서 정리**: README 파일들의 실제 IP 주소를 예제 값으로 변경
- **개발 환경 개선**: .env.example에 새로운 환경변수 추가

### ✅ 종합 테스트 시스템 & 파일 검증 강화 (2025-07-13)
- **종합 테스트 스위트**: 82개 테스트 케이스로 모든 API 엔드포인트 검증
- **100% 테스트 성공률**: 모든 기능이 정상 작동 확인
- **빈 파일 거부 정책**: 검색 엔진 품질 향상을 위한 빈 파일 업로드 차단
- **특수 문자 처리**: JSON 이스케이프를 통한 제어 문자 검색 지원
- **성능 검증**: 모든 검색 유형 200ms 이하 응답 시간 달성
